# Story 3.3: Implement Main IDE Layout on Workspace Entry

## Status

Approved

## Story

**As a** logged-in user,
**I want** to enter a workspace to see the main IDE layout,
**so that** I can start working.

## Acceptance Criteria

1. Clicar em "Entrar" navega para a rota do workspace (ex: `/workspaces/{name}`).
2. A rota exibe a UI principal da IDE com painéis redimensionáveis.

## Tasks / Subtasks

- [ ] Task 1 (AC: 1): Criar rota dinâmica para workspace
  - [ ] Criar arquivo de rota `/workspaces/$workspaceName.tsx` no Remix
  - [ ] Implementar loader para validar workspace existe e carregar dados do workspace.yaml
  - [ ] Implementar validação de autenticação usando SessionService.requireUserId()
  - [ ] Tratar caso de workspace não encontrado com redirecionamento para `/workspaces`
- [ ] Task 2 (AC: 2): Implementar layout principal da IDE
  - [ ] Criar componente `IDELayout` com estrutura de painéis principal
  - [ ] Implementar painéis redimensionáveis usando biblioteca de layout ou CSS Grid/Flexbox
  - [ ] Definir áreas principais: sidebar (file explorer), main content area, bottom panel (future terminal)
  - [ ] Usar shadcn/ui components para consistência visual
- [ ] Task 3: Configurar navegação entre workspaces e IDE
  - [ ] Atualizar WorkspaceList component para usar Link correto para rota do workspace
  - [ ] Implementar breadcrumb ou indicação visual do workspace atual
  - [ ] Adicionar botão "Voltar para Workspaces" no layout da IDE
- [ ] Task 4: Testing
  - [ ] Criar testes para loader da rota do workspace
  - [ ] Testar componente IDELayout render e responsividade
  - [ ] Testar navegação entre dashboard de workspaces e IDE layout
  - [ ] Verificar autenticação e autorização para acessar workspace

## Dev Notes

### Previous Story Insights

- **WorkspaceService Existente**: Service implementado em `apps/web/app/services/workspace.service.ts` com métodos `listWorkspaces()` e `addWorkspace()` funcionais [Source: Previous Story 3.1, 3.2]
- **Rota /workspaces**: Dashboard de workspaces já implementado com lista e botões "Entrar" [Source: Previous Story 3.1]
- **Botões "Entrar"**: Atualmente navegam para rota placeholder - precisam ser conectados à nova rota dinâmica [Source: Previous Story 3.1]
- **Autenticação**: Sistema seguro com `SessionService.requireUserId()` já integrado e testado [Source: Previous Stories 2.x, 3.1, 3.2]
- **Interface Workspace**: Definida em `packages/shared-types/index.ts` como `{ name: string; path: string }` [Source: Previous Story 3.1, 3.2]

### Data Models

- **Workspace Model**: Interface mantém-se como `{ name: string; path: string }` conforme definido [Source: architecture/data-models-revised.md]
- **File Storage**: Workspaces persistidos em `/<cortex_root>/config/workspaces.yaml` [Source: architecture/data-models-revised.md]
- **YAML Structure**: Array de workspaces, acesso via WorkspaceService para validação [Source: architecture/data-models-revised.md]

### API Specifications

- **Workspace Routes**: Usar padrão `loader` (leitura) do Remix para carregar dados do workspace [Source: architecture/api-specification.md]
- **Dynamic Routes**: Remix suporta rotas dinâmicas usando `$workspaceName` syntax [Source: Remix Framework Documentation]
- **Authentication**: Todas as rotas mantêm proteção via `SessionService.requireUserId()` [Source: architecture/api-specification.md]
- **Error Handling**: Usar redirecionamentos adequados para workspace não encontrado [Source: Previous Stories patterns]

### Component Specifications

- **UI Components**: Continuar usando shadcn/ui para consistência visual [Source: architecture/tech-stack.md]
- **Layout Components**: Implementar IDELayout usando padrões estabelecidos no projeto [Source: Previous Stories 3.1, 3.2]
- **Icons**: Usar Lucide Icons para navegação e interface [Source: architecture/tech-stack.md]
- **Styling**: Manter Tailwind CSS 4.1.11 para estilização [Source: architecture/tech-stack.md]
- **Responsive Design**: Implementar layout que funcione em diferentes tamanhos de tela

### File Locations

- **New Route**: Criar `apps/web/app/routes/workspaces.$workspaceName.tsx` para rota dinâmica [Source: architecture/source-tree.md]
- **New Component**: Criar `apps/web/app/components/IDELayout.tsx` para layout principal [Source: architecture/source-tree.md]
- **Service Usage**: Continuar usando `apps/web/app/services/workspace.service.ts` existente [Source: Previous Stories]
- **Shared Types**: Manter interfaces em `packages/shared-types/index.ts` [Source: architecture/coding-standards.md]
- **Config File**: Continuar leitura de `/<cortex_root>/config/workspaces.yaml` [Source: architecture/data-models-revised.md]

### Testing Requirements

- **Test Files**: Usar convenção `*.test.tsx` ou `*.test.ts` [Source: architecture/coding-standards.md]
- **Unit Tests (Vitest)**: Para IDELayout component e workspace route loader [Source: architecture/test-strategy.md]
- **Integration Tests (Vitest)**: Para fluxo completo de navegação workspace → IDE [Source: architecture/test-strategy.md]
- **Coverage**: Manter >80% de cobertura na lógica crítica [Source: architecture/test-strategy.md]
- **Route Testing**: Testar cenários de workspace válido, inválido e não autenticado [Source: Testing Best Practices]

### Technical Constraints

- **Language/Runtime**: Manter TypeScript 5.8, Node.js 22.x [Source: architecture/coding-standards.md]
- **Framework**: Continuar Remix 2.16.8 para rotas e componentes [Source: architecture/tech-stack.md]
- **Service Layer**: Manter toda lógica de negócio em `apps/web/app/services/` [Source: architecture/coding-standards.md]
- **Error Handling**: Usar classes de erro customizadas quando necessário [Source: architecture/coding-standards.md]
- **Layout Responsivity**: Implementar layout que funcione em desktop e mobile [Source: UI/UX Best Practices]

### Project Structure Notes

A estrutura do projeto continua alinhada com os requisitos da story:
- Nova rota dinâmica em `apps/web/app/routes/` conforme padrões do Remix
- Novo componente em `apps/web/app/components/` seguindo estrutura estabelecida
- Uso do WorkspaceService existente sem modificações necessárias
- Interfaces mantidas em `packages/shared-types/` sem alterações
- Acesso ao arquivo `workspaces.yaml` via service layer estabelecido

### Testing

- **Test Files**: Usar convenção `*.test.tsx` ou `*.test.ts` [Source: architecture/coding-standards.md]
- **Unit Tests (Vitest)**: Para IDELayout component e workspace loader [Source: architecture/test-strategy.md]
- **Integration Tests (Vitest)**: Para navegação completa dashboard → IDE [Source: architecture/test-strategy.md]
- **Route Testing**: Testar loader com workspace válido/inválido, autenticação [Source: Testing Best Practices]
- **UI Component Testing**: Testar render do IDELayout e responsividade [Source: Previous Stories patterns]
- **Navigation Testing**: Testar links entre workspaces dashboard e IDE layout [Source: Previous Stories patterns]

## Change Log

| Date       | Version | Description   | Author             |
| ---------- | ------- | ------------- | ------------------ |
| 2025-07-22 | 1.0     | Initial draft | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
[To be filled by development agent]

### Debug Log References
[To be filled by development agent]

### Completion Notes List
[To be filled by development agent]

### File List
[To be filled by development agent]

## QA Results
[To be filled by QA agent]
# Story 2.2: Implement Standard User Login

## Status

Draft

## Story

**As the** registered user,
**I want** to log in to the platform,
**so that** I can access my workspace.

## Acceptance Criteria

1. Uma página de login (`/login`) existe.
2. Visitantes são redirecionados para `/login` se um usuário já existir.
3. O formulário valida as credenciais.
4. Login bem-sucedido cria uma sessão e redireciona para a IDE.
5. Login falho exibe uma mensagem de erro.

## Tasks / Subtasks

- [ ] Task 1 (AC: 1, 2)
  - [ ] Criar rota `/login` no Remix
  - [ ] Implementar loader na rota `/login` que verifica se usuário já está autenticado
  - [ ] Se já autenticado, redirecionar para `/workspaces`
  - [ ] Atualizar loader da rota raiz (`/`) para redirecionar para `/login` quando usuários existem
- [ ] Task 2 (AC: 1, 3)
  - [ ] Criar componente React `LoginForm` usando shadcn/ui
  - [ ] Implementar formulário com campos de email e senha
  - [ ] Adicionar validação client-side com TypeScript
  - [ ] Implementar página `/login` que renderiza o formulário
- [ ] Task 3 (AC: 3, 4)
  - [ ] Implementar action na rota `/login` para processar submissão do formulário
  - [ ] Integrar com `authService` para validação de credenciais usando bcrypt
  - [ ] Implementar criação de sessão usando Remix sessions (reutilizar `sessionService`)
- [ ] Task 4 (AC: 4)
  - [ ] Implementar redirecionamento para `/workspaces` após login bem-sucedido
  - [ ] Atualizar página placeholder de workspaces se necessário
- [ ] Task 5 (AC: 5)
  - [ ] Implementar tratamento de erro para credenciais inválidas
  - [ ] Exibir mensagem de erro amigável no formulário
  - [ ] Garantir que senha não seja exposta em logs ou responses
- [ ] Task 6: Testing
  - [ ] Adicionar testes unitários ao `authService` para validação de login
  - [ ] Criar testes de integração para loader e action da rota `/login`
  - [ ] Testar fluxo completo de login com credenciais válidas e inválidas
  - [ ] Testar redirecionamentos corretos baseados no status de autenticação

## Dev Notes

### Previous Story Insights

- `AuthService` já implementado com métodos `hasUsers()` e `createFirstUser()` [Source: Previous Story 2.1]
- `SessionService` já criado para gerenciamento de sessões com cookie storage seguro [Source: Previous Story 2.1]
- Hash de senhas implementado com bcryptjs (12 salt rounds) [Source: Previous Story 2.1]
- Estrutura de redirecionamento já estabelecida na rota raiz [Source: Previous Story 2.1]
- Página placeholder `/login` já existe para demonstrar fluxo [Source: Previous Story 2.1]

### Data Models

- **User Model**: Interface definida como `{ id: string; email: string; createdAt: Date; updatedAt: Date }` [Source: architecture/data-models-revised.md]
- **Database Schema**: User model no Prisma com campos `id`, `email`, `password`, `createdAt`, `updatedAt` [Source: Previous Story 1.3]
- **Shared Types**: Interfaces em `packages/shared-types` conforme padrão estabelecido [Source: architecture/coding-standards.md]

### API Specifications

- **Authentication Actions**: action para `/setup`, `/login`, `/logout` conforme definido [Source: architecture/api-specification.md]
- **Loaders e Actions**: Usar padrão Remix para `loader`(leitura) e `action`(escrita) [Source: architecture/api-specification.md]

### Component Specifications

- **UI Components**: Usar shadcn/ui para componentes acessíveis e customizáveis [Source: architecture/tech-stack.md]
- **Styling**: Tailwind CSS 4.1.11 para estilização [Source: architecture/tech-stack.md]
- **Icons**: Lucide Icons para ícones [Source: architecture/tech-stack.md]

### File Locations

- **Services**: Lógica de negócio em `apps/web/app/services/` [Source: architecture/coding-standards.md]
- **Components**: Componentes React em `apps/web/app/components/` [Source: architecture/source-tree.md]
- **Routes**: Rotas, Loaders, Actions em `apps/web/app/routes/` [Source: architecture/source-tree.md]
- **Shared Types**: Interfaces TypeScript em `packages/shared-types/` [Source: architecture/source-tree.md]
- **Existing Services**: `authService` e `sessionService` já disponíveis em `apps/web/app/services/` [Source: Previous Story 2.1]

### Testing Requirements

- **Test Files**: Usar convenção `*.test.tsx` ou `*.test.ts` [Source: architecture/coding-standards.md]
- **Unit Tests (Vitest)**: Para testes isolados de services, componentes e funções utilitárias [Source: architecture/test-strategy.md]
- **Integration Tests (Vitest)**: Para testar fluxo completo de Remix routes (loader/action -> service -> test database) [Source: architecture/test-strategy.md]
- **Coverage**: Apontar para >80% de cobertura na lógica de negócio crítica [Source: architecture/test-strategy.md]

### Technical Constraints

- **Language/Runtime**: TypeScript 5.8, Node.js 22.x [Source: architecture/coding-standards.md]
- **Framework**: Remix 2.16.8 para UI e lógica de servidor [Source: architecture/tech-stack.md]
- **Database**: SQLite ~5.x com Prisma 6.x [Source: architecture/tech-stack.md]
- **Environment Variables**: Acesso apenas através de módulo de config central tipado [Source: architecture/coding-standards.md]
- **Service Layer**: Toda lógica de negócio backend deve estar em `apps/web/app/services/` [Source: architecture/coding-standards.md]
- **Error Handling**: Usar classes de erro customizadas ao lançar exceções em services [Source: architecture/coding-standards.md]
- **Password Security**: Continuar usando bcryptjs para validação de senhas [Source: Previous Story 2.1]

### Project Structure Notes

A estrutura do projeto alinha com os requisitos da história:
- Rota `/login` será criada em `apps/web/app/routes/` conforme source-tree.md
- `AuthService` existente será estendido para validação de login [Source: Previous Story 2.1]
- Componentes de UI em `apps/web/app/components/` conforme source-tree.md
- `SessionService` existente será reutilizado para criação de sessões [Source: Previous Story 2.1]

### Testing

- **Test Files**: Usar convenção `*.test.tsx` ou `*.test.ts` [Source: architecture/coding-standards.md]
- **Unit Tests (Vitest)**: Para testes isolados de services, componentes e funções utilitárias [Source: architecture/test-strategy.md]
- **Integration Tests (Vitest)**: Para testar fluxo completo de Remix routes (loader/action -> service -> test database) [Source: architecture/test-strategy.md]
- **Coverage**: Apontar para >80% de cobertura na lógica de negócio crítica [Source: architecture/test-strategy.md]
- **Test Data Management**: Usar Prisma seed script para popular test database, garantindo testes consistentes [Source: architecture/test-strategy.md]

## Change Log

| Date       | Version | Description   | Author             |
| ---------- | ------- | ------------- | ------------------ |
| 2025-07-22 | 1.0     | Initial draft | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_Pendente - será preenchido pelo agente de desenvolvimento_

### Debug Log References

_Pendente - será preenchido pelo agente de desenvolvimento_

### Completion Notes List

_Pendente - será preenchido pelo agente de desenvolvimento_

### File List

_Pendente - será preenchido pelo agente de desenvolvimento_

## QA Results

_Pendente - será preenchido pelo agente de QA_
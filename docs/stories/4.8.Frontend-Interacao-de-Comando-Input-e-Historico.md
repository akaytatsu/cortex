# Story 4.8: Frontend - Interação de Comando (Input e Histórico)

**Status**: Draft

## Story
**As a** Usuário(a),
**I want** uma área de input para enviar comandos para a sessão ativa e um histórico de comandos,
**so that** eu possa interagir eficientemente com o `claude code`.

## Acceptance Criteria
1. Uma caixa de input no painel do copiloto permite digitar e enviar comandos via WebSocket.
2. Os comandos enviados pelo usuário são visíveis no histórico da conversa.
3. A caixa de input permite navegar pelo histórico de comandos com as setas (cima/baixo).

## Tasks / Subtasks
- [ ] **Task 1: Criar Componente de Input de Comando** (AC: 1, 3)
  - [ ] Subtask 1.1: Criar o arquivo `apps/web/app/components/CommandInput.tsx`. [Source: architecture/source-tree.md]
  - [ ] Subtask 1.2: O componente deve incluir um campo de texto e um botão "Enviar".
  - [ ] Subtask 1.3: Implementar a lógica para manter um histórico dos comandos enviados.
  - [ ] Subtask 1.4: Implementar a navegação pelo histórico de comandos usando as teclas de seta para cima e para baixo no campo de texto.

- [ ] **Task 2: Integrar o Envio de Comandos com o Hook WebSocket** (AC: 1)
  - [ ] Subtask 2.1: Modificar o hook `useMultipleClaudeCodeSessions.ts` para expor uma função `sendCommand(sessionId, command)`.
  - [ ] Subtask 2.2: A função `sendCommand` deve enviar uma mensagem do tipo `input` através da conexão WebSocket correspondente ao `sessionId`. [Source: architecture/data-models-revised.md]
  - [ ] Subtask 2.3: Integrar o `CommandInput.tsx` no `CopilotPanel.tsx`, passando a função `sendCommand` e o `sessionId` ativo como props.

- [ ] **Task 3: Exibir Comandos Enviados na UI** (AC: 2)
  - [ ] Subtask 3.1: Modificar o `CopilotPanel.tsx` para que, ao enviar um comando, ele seja adicionado à exibição da conversa.
  - [ ] Subtask 3.2: Diferenciar visualmente os comandos do usuário da saída do agente (por exemplo, com um prefixo `> ` ou cor diferente).

- [ ] **Task 4: Adicionar Testes** (AC: 1, 2, 3)
  - [ ] Subtask 4.1: Criar testes de unidade para o `CommandInput.tsx`, verificando a navegação do histórico e o callback de envio. [Source: architecture/test-strategy.md]
  - [ ] Subtask 4.2: Adicionar testes ao hook `useMultipleClaudeCodeSessions` para validar a funcionalidade de `sendCommand`.

## Dev Notes

### Previous Story Insights
- A estória 4.7 estabeleceu o `CopilotPanel.tsx` e o hook `useMultipleClaudeCodeSessions.ts` para gerenciar múltiplas conexões WebSocket. Esta estória irá adicionar a capacidade de interagir com essas sessões.

### Data Models
- A interação enviará mensagens que aderem à interface `TerminalMessage`, com `type: 'input'`. A interface está definida em `packages/shared-types/index.ts`. [Source: architecture/data-models-revised.md]
  ```typescript
  export interface TerminalMessage {
    type: 'input' | 'output' | 'error' | 'exit';
    data: string;
    sessionId: string;
  }
  ```

### API Specifications
- A comunicação é feita exclusivamente via WebSocket. Não há novos endpoints de API REST. O contrato é a mensagem `TerminalMessage` enviada através da conexão WebSocket estabelecida.

### Component Specifications
- **`CommandInput.tsx` (Novo)**: Um componente reutilizável que encapsula o campo de texto, o botão de envio e a lógica de histórico de comandos.
- **`CopilotPanel.tsx` (Modificado)**: Será atualizado para incluir o `CommandInput` e para exibir os comandos enviados pelo usuário no log da sessão.
- **`useMultipleClaudeCodeSessions.ts` (Modificado)**: O hook precisa ser estendido para fornecer uma função para enviar comandos para uma sessão específica.

### File Locations
- **Componentes**: `apps/web/app/components/` [Source: architecture/source-tree.md]
- **Hooks**: `apps/web/app/hooks/` [Source: architecture/source-tree.md]

### Testing Requirements
- **Framework**: Vitest [Source: architecture/test-strategy.md]
- Testar o novo componente `CommandInput.tsx` de forma isolada, mockando a função de envio.
- Testar a nova função no hook `useMultipleClaudeCodeSessions` para garantir que a mensagem correta seja enviada pela WebSocket.
- Testar a atualização da UI no `CopilotPanel` para verificar se os comandos enviados são exibidos corretamente.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-07-24 | 1.0 | Initial story draft | Bob (Scrum Master) |
